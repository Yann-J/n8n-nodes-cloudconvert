# n8n-nodes-cloudconvert

![logo](./nodes/CloudConvert/cloudconvert-logo.png)

[![npm version](https://badge.fury.io/js/n8n-nodes-cloudconvert.svg)](https://badge.fury.io/js/n8n-nodes-cloudconvert)

[![.github/workflows/publish-npm.yml](https://github.com/Yann-J/n8n-nodes-cloudconvert/actions/workflows/publish-npm.yml/badge.svg)](https://github.com/Yann-J/n8n-nodes-cloudconvert/actions/workflows/publish-npm.yml)

This is an n8n community node. It lets you use [_CloudConvert_](https://cloudconvert.com) in your n8n workflows.

[_CloudConvert_](https://cloudconvert.com) is an online service providing all sorts of file processing / transformation features, that can be used to convert or tweak PDFs, images, ebooks, audio, documents, etc...

[n8n](https://n8n.io/) is a [fair-code licensed](https://docs.n8n.io/reference/license/) workflow automation platform.

[Installation](#installation)  
[Operations](#operations)  
[Credentials](#credentials)  <!-- delete if no auth needed -->  
[Compatibility](#compatibility)  
[Usage](#usage)  <!-- delete if not using this section -->  
[Resources](#resources)  

## Installation

Follow the [installation guide](https://docs.n8n.io/integrations/community-nodes/installation/) in the n8n community nodes documentation.

## Operations

### Action Node

- Jobs:
  - Create (sync or async, with file upload / download options)
  - List
  - Get One
  - Delete
- Webhooks
  - List
  - Delete

### Trigger Node

- Receive webhook (with file download option)

## Credentials

Authentication relies on an API key that you can generate from your CloudConvert [dashboard](https://cloudconvert.com/dashboard). Both live and [sandbox](https://sandbox.cloudconvert.com) environments are supported. You will likely need the `task.read` and `task.write` scopes, but the Trigger node also requires the `webhook.read` and `webhook.write` scopes.

Note that sandbox credentials are separate from live credentials.

## Compatibility

Tested on n8n 0.206.1

## Usage

### Sandbox Usage

Note that it's strongly recommended to perform your tests against the sandbox environment, which needs to be enabled first and which uses a separate API key. Note that:

- Separate credentials should be created for the live and sandbox environments.
- The main limitation of the sandbox environment is that all imported files need to be whitelisted first before processing (based on the file's `md5` hash).

### Job Definitions

The most useful operation is to send new conversion jobs to CloudConvert. The definition of each job is done in JSON format, and the [CloudConvert Job Builder UI](https://cloudconvert.com/api/v2/jobs/builder) can be used to build the job definition visually and interactively, and copy-paste the resulting JSON.

Here's a sample workflow / node definition:

![logo](./docs/workflow.png)

![logo](./docs/sample.png)

### File Upload Support

When checked, in the Create Job operation, the __Upload Input Binaries__ option will cause the following:

- Binary attachments of any item sent to the node as input will be uploaded to CloudConvert as an `import/base64` task.
- The tasks will be named `autoimport-<binary_name>`, where `<binary_name>` is the property name holding the attachment
- The tasks will be automatically added to the job definition, there's no need to specify them. However, you will still need to specify the task name as input to any following task that is expected to process that imported file.

### File Download Support

In the Create Job operation (only if the call is made synchronously), as well as in the Trigger node, there is an option to automatically download any resulting file exported by the job upon completion. Note that:

- Only the files generated by `export/url` tasks are supported
- The files will be added as binary attachments to the node's output items. The name of the binary property will be `<task_name>_<N>` where:
  - `<task_name>` is the name of the export task
  - `<N>` is the sequence number - since an export task may output more than one file. This will most often be `0`

### Webhook Signature Verification

The Trigger node can optionally enforce signature verification on incoming calls. It will automatically fetch the signature key from the webhook definition in CloudConvert, and will use it to validate the signature sent in the webhook calls in the `CloudConvert-Signature` HTTP header, to ensure that the call is indeed being initiated from CloudConvert.

When enabled, incoming webhook calls failing validation will be silently ignored.

## Resources

- [n8n community nodes documentation](https://docs.n8n.io/integrations/community-nodes/)
- [CloudConvert API Docs](https://cloudconvert.com/api/v2)
- [The CloudConvert Visual Job Builder](https://cloudconvert.com/api/v2/jobs/builder#) which can be used to build the job definition JSON

## TODO

- Improve logging?
